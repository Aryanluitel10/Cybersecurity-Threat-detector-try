<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Threat Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(270deg, #020617, #450a0a, #020617);
            background-size: 600% 600%;
            animation: gradientAnimation 16s ease infinite;
        }
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #results, #ai-results {
            transition: opacity 0.5s ease-in-out;
        }
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .gemini-button {
            background: linear-gradient(90deg, #4f46e5, #c026d3);
        }
        .gemini-button:hover {
            background: linear-gradient(90deg, #4338ca, #a21caf);
        }
    </style>
</head>
<body class="gradient-bg text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto p-8 bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl shadow-lg">
        <h1 class="text-4xl font-bold text-center mb-2 text-cyan-400">Cybersecurity Threat Detector</h1>
        <p class="text-center text-gray-400 mb-8">Enhanced with Gemini AI Analysis</p>

        <div class="mb-6">
            <label for="userInput" class="block text-sm font-medium text-gray-300 mb-2">Enter URL or Text</label>
            <textarea id="userInput" rows="4" class="w-full p-4 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition duration-200" placeholder="e.g., https://example.com or 'Click here to claim your prize!'"></textarea>
        </div>

        <div class="flex space-x-4">
            <button id="scanButton" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 flex items-center justify-center">
                <span id="scanButtonText">Scan for Threats</span>
                <div id="loadingSpinner" class="spinner hidden ml-2"></div>
            </button>
            <button id="clearButton" class="w-1/4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                Clear
            </button>
        </div>

        <div id="results" class="mt-8 hidden opacity-0">
            <h2 class="text-2xl font-semibold mb-4 text-cyan-400">Analysis Results</h2>
            <div id="results-content" class="bg-gray-700 p-6 rounded-lg">
                <!-- Results will be injected here by JavaScript -->
            </div>
        </div>

        <div id="ai-results" class="mt-6 hidden opacity-0">
            <h2 class="text-2xl font-semibold mb-4 text-indigo-400">âœ¨ Gemini AI Analysis</h2>
            <div id="ai-results-content" class="bg-gray-900/50 p-6 rounded-lg border border-indigo-500">
                 <!-- AI analysis will be injected here -->
            </div>
        </div>
    </div>

    <script>
        const scanButton = document.getElementById('scanButton');
        const scanButtonText = document.getElementById('scanButtonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const clearButton = document.getElementById('clearButton');
        const userInput = document.getElementById('userInput');
        const resultsDiv = document.getElementById('results');
        const resultsContent = document.getElementById('results-content');
        const aiResultsDiv = document.getElementById('ai-results');
        const aiResultsContent = document.getElementById('ai-results-content');

        const phishingKeywords = ['login', 'verify', 'account', 'secure', 'update', 'confirm', 'password', 'signin', 'bank', 'credential'];
        const suspiciousTlds = ['.xyz', '.top', '.loan', 'club', 'info', 'gq', '.work', '.biz', '.link'];
        const scamKeywords = ['free', 'winner', 'prize', 'congratulations', 'urgent', 'claim', 'selected', 'cash', 'reward', 'instant', 'unlimited'];
        const urlShorteners = ['bit.ly', 't.co', 'goo.gl', 'tinyurl.com', 'is.gd', 'ow.ly'];
        
        let lastAnalysis = {};

        scanButton.addEventListener('click', () => {
            const input = userInput.value.trim();
            if (!input) {
                showResults();
                resultsContent.innerHTML = `<p class="text-yellow-400 text-center">Please enter a URL or text to analyze.</p>`;
                return;
            }
            scanButton.disabled = true;
            scanButtonText.innerText = 'Scanning...';
            loadingSpinner.classList.remove('hidden');
            aiResultsDiv.classList.add('hidden', 'opacity-0');

            analyzeInput(input);
        });
        
        clearButton.addEventListener('click', () => {
            userInput.value = '';
            resultsDiv.classList.add('hidden', 'opacity-0');
            aiResultsDiv.classList.add('hidden', 'opacity-0');
            resultsContent.innerHTML = '';
            aiResultsContent.innerHTML = '';
        });

        function analyzeInput(input) {
            setTimeout(() => {
                let threats = [];
                let threatScore = 0;
                
                const isUrl = /^(https?:\/\/)?(([\da-z\.-]+)\.([a-z\.]{2,6})|(\d{1,3}(\.\d{1,3}){3}))([\/\w \.-]*)*\/?$/.test(input);
                
                if (isUrl) {
                    const urlInput = input.startsWith('http') ? input : `http://${input}`;
                    
                    try {
                        const url = new URL(urlInput);

                        if (phishingKeywords.some(keyword => url.hostname.includes(keyword) || url.pathname.includes(keyword))) {
                            threats.push({ type: 'Phishing Warning', message: 'URL contains keywords often used in phishing scams.', severity: 'High' });
                            threatScore += 30;
                        }

                        if (suspiciousTlds.some(tld => url.hostname.endsWith(tld))) {
                            threats.push({ type: 'Suspicious TLD', message: 'The domain uses a top-level domain often associated with malicious sites.', severity: 'High' });
                            threatScore += 30;
                        }

                        if ((url.hostname.match(/\./g) || []).length > 2) {
                            threats.push({ type: 'Suspicious Subdomains', message: 'URL has multiple subdomains, which can obscure the true domain.', severity: 'Medium' });
                            threatScore += 20;
                        }

                        if (/^(\d{1,3}(\.\d{1,3}){3})$/.test(url.hostname)) {
                             threats.push({ type: 'IP Address URL', message: 'URL is a direct IP address, which can be suspicious.', severity: 'High' });
                            threatScore += 40;
                        }

                        if (urlShorteners.some(shortener => url.hostname.includes(shortener))) {
                            threats.push({ type: 'URL Shortener Detected', message: 'URL shorteners can hide the final destination of the link.', severity: 'Medium' });
                            threatScore += 20;
                        }

                    } catch (e) {
                         threats.push({ type: 'Invalid URL', message: 'The provided URL could not be analyzed.', severity: 'Low' });
                    }
                } else {
                    const lowerCaseInput = input.toLowerCase();
                    scamKeywords.forEach(keyword => {
                        if (lowerCaseInput.includes(keyword)) {
                            threats.push({ type: 'Scam Keyword Detected', message: `The text contains the suspicious keyword: "${keyword}".`, severity: 'Medium' });
                            threatScore += 15;
                        }
                    });
                     if (lowerCaseInput.includes('password') || lowerCaseInput.includes('credit card') || lowerCaseInput.includes('ssn')) {
                        threats.push({ type: 'Sensitive Data Request', message: 'The text appears to be asking for sensitive personal information.', severity: 'High' });
                        threatScore += 40;
                    }
                }
                
                lastAnalysis = { input, threats };
                displayResults(threats, Math.min(threatScore, 100));
                
                scanButton.disabled = false;
                scanButtonText.innerText = 'Scan for Threats';
                loadingSpinner.classList.add('hidden');
            }, 1000);
        }
        
        function showResults() {
             resultsDiv.classList.remove('hidden');
             setTimeout(() => resultsDiv.classList.remove('opacity-0'), 10);
        }
        
        function showAiResults() {
             aiResultsDiv.classList.remove('hidden');
             setTimeout(() => aiResultsDiv.classList.remove('opacity-0'), 10);
        }

        function displayResults(threats, score) {
            showResults();
            
            if (threats.length === 0) {
                resultsContent.innerHTML = `
                    <div class="text-center">
                        <svg class="mx-auto h-12 w-12 text-green-400" fill="none" viewBox="0 0 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="mt-2 text-lg font-medium text-green-300">No Threats Detected</h3>
                        <p class="mt-1 text-sm text-gray-400">This input appears to be safe.</p>
                    </div>
                `;
            } else {
                let scoreColor = 'text-yellow-400';
                if (score > 65) scoreColor = 'text-red-500';
                else if (score < 35) scoreColor = 'text-green-400';
            
                let threatsHtml = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-red-400">Potential Threats Found!</h3>
                        <div class="text-right">
                            <span class="font-bold text-xl ${scoreColor}">${score}</span>
                            <p class="text-xs text-gray-400">Threat Score</p>
                        </div>
                    </div>
                    <ul class="space-y-3">
                `;
                threats.forEach(threat => {
                    let severityColor = 'bg-yellow-900/50 text-yellow-300';
                    if (threat.severity === 'High') severityColor = 'bg-red-900/50 text-red-300';
                    if (threat.severity === 'Low') severityColor = 'bg-blue-900/50 text-blue-300';
                    
                    threatsHtml += `
                        <li class="bg-gray-800 p-4 rounded-md border-l-4 border-red-500">
                            <div class="flex justify-between items-center">
                                <p class="font-semibold text-red-400">${threat.type}</p>
                                <span class="text-xs font-medium px-2 py-1 rounded-full ${severityColor}">${threat.severity}</span>
                            </div>
                            <p class="text-gray-300 mt-1">${threat.message}</p>
                        </li>
                    `;
                });
                threatsHtml += `</ul>
                <button id="getAIAnalysisButton" class="w-full mt-6 gemini-button text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 flex items-center justify-center">
                    <span id="aiButtonText">âœ¨ Get Deeper AI Analysis</span>
                    <div id="aiLoadingSpinner" class="spinner hidden ml-2"></div>
                </button>
                `;
                resultsContent.innerHTML = threatsHtml;

                document.getElementById('getAIAnalysisButton').addEventListener('click', handleAiAnalysis);
            }
        }

        async function handleAiAnalysis() {
            const aiButton = document.getElementById('getAIAnalysisButton');
            const aiButtonText = document.getElementById('aiButtonText');
            const aiLoadingSpinner = document.getElementById('aiLoadingSpinner');

            aiButton.disabled = true;
            aiButtonText.innerText = 'Analyzing...';
            aiLoadingSpinner.classList.remove('hidden');

            showAiResults();
            aiResultsContent.innerHTML = '<p class="text-center text-gray-400">Contacting Gemini for deeper insights...</p>';
            
            const { input, threats } = lastAnalysis;
            const threatSummary = threats.map(t => t.type).join(', ');

            const systemPrompt = "You are a senior cybersecurity analyst. Your role is to analyze potential threats and explain them in a clear, concise, and easy-to-understand way for a non-technical audience. Do not be alarmist, but clearly state the potential risks. Use markdown for formatting.";
            const userQuery = `Based on the following input and the threats my tool initially detected, provide a deeper analysis. Input: "${input}". Initial threats found: [${threatSummary}]. Use your knowledge and current information from the web to explain the risks associated with this specific input. Explain why each detected threat is a concern.`;

            try {
                const generatedText = await callGemini(systemPrompt, userQuery);
                // Basic markdown to HTML conversion
                let htmlContent = generatedText
                    .replace(/(\*\*|__)(.*?)\1/g, '<strong>$2</strong>') // Bold
                    .replace(/(\*|_)(.*?)\1/g, '<em>$2</em>')       // Italic
                    .replace(/```(.*?)```/gs, '<pre class="bg-gray-800 p-2 rounded"><code>$1</code></pre>') // Code blocks
                    .replace(/`(.*?)`/g, '<code class="bg-gray-800 px-1 rounded">$1</code>') // Inline code
                    .replace(/\n/g, '<br>');

                aiResultsContent.innerHTML = `<div class="prose prose-invert max-w-none text-gray-300">${htmlContent}</div>`;
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                aiResultsContent.innerHTML = `<p class="text-red-400 text-center">Sorry, the AI analysis failed. Please try again later.</p>`;
            } finally {
                aiButton.disabled = false;
                aiButtonText.innerText = 'âœ¨ Get Deeper AI Analysis';
                aiLoadingSpinner.classList.add('hidden');
            }
        }

        async function callGemini(systemPrompt, userQuery, retries = 3, delay = 1000) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text;
                    } else {
                        throw new Error('No valid content in API response.');
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }
    </script>

</body>
</html>




